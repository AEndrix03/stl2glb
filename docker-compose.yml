version: "3.9"

services:
  stl2glb:
    build: .
    ports:
      - "9002:${STL2GLB_PORT}"
    env_file:
      - .env
    volumes:
      - ./:/project
      - vcpkg_data:/opt/vcpkg/installed
      - vcpkg_cache:/opt/vcpkg/packages
      - vcpkg_buildtrees:/opt/vcpkg/buildtrees
    working_dir: /project/build
    command: >
      bash -c "
      cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_TOOLCHAIN_FILE=/opt/vcpkg/scripts/buildsystems/vcpkg.cmake -G Ninja &&
      cmake --build .
      ./stl2glb_exec
      "

volumes:
  vcpkg_data:
  vcpkg_cache:
  vcpkg_buildtrees:
